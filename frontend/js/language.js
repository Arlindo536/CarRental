// Language translations object
const translations = {
    'sq': { // Albanian
        'nav_home': 'Kryefaqja',
        'nav_cars': 'Makinat',
        'nav_locations': 'Lokacionet',
        'nav_about': 'Rreth Nesh',
        'nav_contact': 'Kontakt',
        'hero_title': 'Makina të Përshtatshme për Çdo Nevojë',
        'hero_subtitle': 'Zgjidhni nga flota jonë e gjerë dhe rezervoni me çmime konkurruese',
        'hero_button': 'Shiko Makinat',
        'cars_title': 'Prezantimi i Makinave',
        'car_filter_all': 'Të gjitha',
        'car_filter_economy': 'Ekonomik',
        'car_filter_family': 'Familjar',
        'car_filter_luxury': 'Luksoz',
        'car_filter_suv': 'SUV',
        'car_passengers': 'Pasagjerë',
        'car_transmission': 'Transmisioni',
        'car_luggage': 'Valixhe',
        'car_features': 'Veçori',
        'car_price_day': '€ / ditë',
        'contact_us': 'Na Kontaktoni',
        'call_us': 'Telefono',
        'whatsapp_us': 'WhatsApp',
        'email_us': 'Email',
        'locations_title': 'Lokacionet Tona',
        'location_hours': 'Orari',
        'about_title': 'Rreth Nesh',
        'about_history': 'Historia Jonë',
        'about_history_text': 'CarRental është një platformë moderne për marrjen me qira të makinave, e ndërtuar për të ofruar një përvojë të thjeshtë dhe të shpejtë. Ne kemi filluar aktivitetin tonë në vitin 2018 me një flotë të vogël prej 5 makinash dhe tani kemi arritur të zgjerojmë flotën tonë në më shumë se 50 makina.',
        'about_mission': 'Misioni Ynë',
        'about_mission_text': 'Misioni ynë është të ofrojmë shërbim cilësor për klientët tanë, duke u fokusuar në siguri, komoditet dhe çmime konkurruese.',
        'testimonials': 'Dëshmi nga Klientët',
        'contact_title': 'Na Kontaktoni',
        'contact_phone': 'Telefon',
        'contact_email': 'Email',
        'contact_whatsapp': 'WhatsApp',
        'contact_social': 'Rrjete Sociale',
        'contact_message': 'Na Dërgoni një Mesazh',
        'contact_name': 'Emri',
        'contact_message_label': 'Mesazhi',
        'contact_send': 'Dërgo',
        'footer_copyright': '© 2023 CarRental. Të gjitha të drejtat e rezervuara.',
        'no_cars_found': 'Nuk u gjetën makina që përputhen me kriteret e kërkimit.',
        'message_sent': 'Mesazhi juaj u dërgua! Do t\'ju kontaktojmë së shpejti.'
    },
    'en': { // English
        'nav_home': 'Home',
        'nav_cars': 'Cars',
        'nav_locations': 'Locations',
        'nav_about': 'About Us',
        'nav_contact': 'Contact',
        'hero_title': 'Cars Suitable for Every Need',
        'hero_subtitle': 'Choose from our wide fleet and book at competitive prices',
        'hero_button': 'View Cars',
        'cars_title': 'Our Cars',
        'car_filter_all': 'All',
        'car_filter_economy': 'Economy',
        'car_filter_family': 'Family',
        'car_filter_luxury': 'Luxury',
        'car_filter_suv': 'SUV',
        'car_passengers': 'Passengers',
        'car_transmission': 'Transmission',
        'car_luggage': 'Luggage',
        'car_features': 'Features',
        'car_price_day': '€ / day',
        'contact_us': 'Contact Us',
        'call_us': 'Call',
        'whatsapp_us': 'WhatsApp',
        'email_us': 'Email',
        'locations_title': 'Our Locations',
        'location_hours': 'Hours',
        'about_title': 'About Us',
        'about_history': 'Our History',
        'about_history_text': 'CarRental is a modern platform for car rental, built to provide a simple and fast experience. We started our activity in 2018 with a small fleet of 5 cars and now we have managed to expand our fleet to more than 50 cars.',
        'about_mission': 'Our Mission',
        'about_mission_text': 'Our mission is to provide quality service to our customers, focusing on safety, comfort and competitive prices.',
        'testimonials': 'Customer Testimonials',
        'contact_title': 'Contact Us',
        'contact_phone': 'Phone',
        'contact_email': 'Email',
        'contact_whatsapp': 'WhatsApp',
        'contact_social': 'Social Networks',
        'contact_message': 'Send Us a Message',
        'contact_name': 'Name',
        'contact_message_label': 'Message',
        'contact_send': 'Send',
        'footer_copyright': '© 2023 CarRental. All rights reserved.',
        'no_cars_found': 'No cars found matching the search criteria.',
        'message_sent': 'Your message has been sent! We will contact you soon.'
    },
    'de': { // German
        'nav_home': 'Startseite',
        'nav_cars': 'Autos',
        'nav_locations': 'Standorte',
        'nav_about': 'Über Uns',
        'nav_contact': 'Kontakt',
        'hero_title': 'Fahrzeuge für jeden Bedarf',
        'hero_subtitle': 'Wählen Sie aus unserer großen Flotte und buchen Sie zu wettbewerbsfähigen Preisen',
        'hero_button': 'Autos Ansehen',
        'cars_title': 'Unsere Autos',
        'car_filter_all': 'Alle',
        'car_filter_economy': 'Wirtschaft',
        'car_filter_family': 'Familie',
        'car_filter_luxury': 'Luxus',
        'car_filter_suv': 'SUV',
        'car_passengers': 'Passagiere',
        'car_transmission': 'Getriebe',
        'car_luggage': 'Gepäck',
        'car_features': 'Funktionen',
        'car_price_day': '€ / Tag',
        'contact_us': 'Kontaktieren Sie uns',
        'call_us': 'Anrufen',
        'whatsapp_us': 'WhatsApp',
        'email_us': 'Email',
        'locations_title': 'Unsere Standorte',
        'location_hours': 'Öffnungszeiten',
        'about_title': 'Über Uns',
        'about_history': 'Unsere Geschichte',
        'about_history_text': 'CarRental ist eine moderne Plattform für Autovermietungen, die entwickelt wurde, um ein einfaches und schnelles Erlebnis zu bieten. Wir haben unsere Tätigkeit im Jahr 2018 mit einer kleinen Flotte von 5 Autos begonnen und konnten unsere Flotte mittlerweile auf mehr als 50 Autos erweitern.',
        'about_mission': 'Unsere Mission',
        'about_mission_text': 'Unsere Mission ist es, unseren Kunden einen qualitativ hochwertigen Service zu bieten, wobei der Schwerpunkt auf Sicherheit, Komfort und wettbewerbsfähigen Preisen liegt.',
        'testimonials': 'Kundenbewertungen',
        'contact_title': 'Kontaktieren Sie Uns',
        'contact_phone': 'Telefon',
        'contact_email': 'E-Mail',
        'contact_whatsapp': 'WhatsApp',
        'contact_social': 'Soziale Netzwerke',
        'contact_message': 'Senden Sie uns eine Nachricht',
        'contact_name': 'Name',
        'contact_message_label': 'Nachricht',
        'contact_send': 'Senden',
        'footer_copyright': '© 2023 CarRental. Alle Rechte vorbehalten.',
        'no_cars_found': 'Keine Autos gefunden, die den Suchkriterien entsprechen.',
        'message_sent': 'Ihre Nachricht wurde gesendet! Wir werden Sie bald kontaktieren.'
    }
};

// Current language (default is Albanian)
let currentLanguage = 'sq';

// Function to change the language
function changeLanguage(language) {
    if (!translations[language]) {
        console.error(`Language '${language}' is not supported.`);
        return;
    }

    currentLanguage = language;
    
    // Update all text elements with data-i18n attribute
    document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[language][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                if (element.getAttribute('placeholder')) {
                    element.setAttribute('placeholder', translations[language][key]);
                } else {
                    element.value = translations[language][key];
                }
            } else {
                element.textContent = translations[language][key];
            }
        }
    });

    // Update placeholders
    document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
        const key = element.getAttribute('data-i18n-placeholder');
        if (translations[language][key]) {
            element.setAttribute('placeholder', translations[language][key]);
        }
    });

    // Update car display and other dynamic content
    displayCarsWithTranslation(document.getElementById('car-type').value);

    // Save language preference to localStorage
    localStorage.setItem('preferredLanguage', language);
    
    // Update language selector buttons active state
    document.querySelectorAll('.language-selector button').forEach(btn => {
        if (btn.getAttribute('data-lang') === language) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });
}

// Initialize the language based on saved preference or browser default
function initializeLanguage() {
    // Check if user has a saved preference
    const savedLanguage = localStorage.getItem('preferredLanguage');
    
    if (savedLanguage && translations[savedLanguage]) {
        currentLanguage = savedLanguage;
    } else {
        // Try to detect browser language
        const browserLang = navigator.language || navigator.userLanguage;
        const shortLang = browserLang.split('-')[0];
        
        if (translations[shortLang]) {
            currentLanguage = shortLang;
        }
        // If not supported, keep the default language (sq)
    }
    
    // Apply the language
    changeLanguage(currentLanguage);
}

// Setup language selector
function setupLanguageSelector() {
    // Create language selector element if it doesn't exist
    if (!document.querySelector('.language-selector')) {
        const selectorContainer = document.createElement('div');
        selectorContainer.className = 'language-selector';
        
        // Create buttons for each language
        Object.keys(translations).forEach(langCode => {
            const langButton = document.createElement('button');
            langButton.setAttribute('data-lang', langCode);
            langButton.textContent = langCode.toUpperCase();
            langButton.addEventListener('click', () => changeLanguage(langCode));
            selectorContainer.appendChild(langButton);
        });
        
        // Add the selector to the header
        const header = document.querySelector('header .container');
        header.appendChild(selectorContainer);
    }
    
    // Initialize with saved or detected language
    initializeLanguage();
}

// Call this function when the page loads
document.addEventListener('DOMContentLoaded', function() {
    setupLanguageSelector();
    // Other initialization code...
});

// Modified displayCars function to use translations
function displayCarsWithTranslation(filter = '') {
    const carsContainer = document.querySelector('.cars-container');
    carsContainer.innerHTML = '';

    // Use the local carsData array instead of API data for language translation purposes
    const dataToUse = carsData || []; // Use carsData (renamed from cars)
    
    // Filter cars if needed
    const filteredCars = filter ? dataToUse.filter(car => car.type === filter) : dataToUse;
    
    console.log('Filtered cars in language.js:', filteredCars);
    
    // Make sure filteredCars is an array
    if (!Array.isArray(filteredCars)) {
        console.error('filteredCars is not an array:', filteredCars);
        carsContainer.innerHTML = '<p>Error: Invalid data format</p>';
        return;
    }
    // Create car elements
    filteredCars.forEach(car => {
        const carElement = document.createElement('div');
        carElement.className = 'car-card';
        
        // Get translated text
        const translatedPassengers = translations[currentLanguage]['car_passengers'] || 'Passengers';
        const translatedTransmission = translations[currentLanguage]['car_transmission'] || 'Transmission';
        const translatedLuggage = translations[currentLanguage]['car_luggage'] || 'Luggage';
        const translatedFeatures = translations[currentLanguage]['car_features'] || 'Features';
        const translatedPriceDay = translations[currentLanguage]['car_price_day'] || '€ / day';
        const translatedCall = translations[currentLanguage]['call_us'] || 'Call';
        const translatedWhatsApp = translations[currentLanguage]['whatsapp_us'] || 'WhatsApp';
        const translatedEmail = translations[currentLanguage]['email_us'] || 'Email';
        
        // Get translated transmission type
        let transmissionText = car.transmission;
        if (currentLanguage === 'en' && transmissionText === 'Automatike') {
            transmissionText = 'Automatic';
        } else if (currentLanguage === 'en' && transmissionText === 'Manuale') {
            transmissionText = 'Manual';
        } else if (currentLanguage === 'de' && transmissionText === 'Automatike') {
            transmissionText = 'Automatik';
        } else if (currentLanguage === 'de' && transmissionText === 'Manuale') {
            transmissionText = 'Manuell';
        }
        
        carElement.innerHTML = `
            <div class="car-image" style="background-image: url('images/${car.image}')"></div>
            <div class="car-details">
                <h3>${car.name} (${car.year})</h3>
                <p><strong>${translatedPassengers}:</strong> ${car.passengers}</p>
                <p><strong>${translatedTransmission}:</strong> ${transmissionText}</p>
                <p><strong>${translatedLuggage}:</strong> ${car.luggage}</p>
                <p><strong>${translatedFeatures}:</strong> ${translateFeatures(car.features, currentLanguage)}</p>
                <p class="car-price">${car.price}${translatedPriceDay}</p>
                <div class="contact-buttons">
                    <a href="tel:${contactInfo.phone}" class="contact-btn phone-btn"><i class="fas fa-phone"></i> ${translatedCall}</a>
                    <a href="https://wa.me/${contactInfo.whatsapp.replace(/\s+/g, '')}" class="contact-btn whatsapp-btn" target="_blank"><i class="fab fa-whatsapp"></i> ${translatedWhatsApp}</a>
                    <a href="mailto:${contactInfo.email}?subject=Interes për ${car.name}&body=Përshëndetje, jam i interesuar për makinën ${car.name} me çmim ${car.price}€ / ditë. Ju lutem më kontaktoni për të diskutuar në detaje." class="contact-btn email-btn"><i class="fas fa-envelope"></i> ${translatedEmail}</a>
                </div>
            </div>
        `;
        carsContainer.appendChild(carElement);
    });

    // If no cars match the filter
    if (filteredCars.length === 0) {
        const noResultsMessage = translations[currentLanguage]['no_cars_found'] || 'No cars found matching the search criteria.';
        carsContainer.innerHTML = `<p>${noResultsMessage}</p>`;
    }
}

// Helper function to translate car features
function translateFeatures(features, language) {
    if (language === 'sq') return features.join(', ');
    
    // Define translations for common features
    const featureTranslations = {
        'en': {
            'Klimë': 'Air Conditioning',
            'Bluetooth': 'Bluetooth',
            'Kamera Parkimi': 'Parking Camera',
            'Navigacion': 'Navigation',
            'Sedilje Lëkure': 'Leather Seats',
            'Sensorë Parkimi': 'Parking Sensors',
            '4x4': '4x4',
            'Kamera 360': '360 Camera',
            'Android Auto': 'Android Auto',
            'Autopilot': 'Autopilot',
            'Kamerat': 'Cameras',
            'Karikues': 'Charger'
        },
        'de': {
            'Klimë': 'Klimaanlage',
            'Bluetooth': 'Bluetooth',
            'Kamera Parkimi': 'Parkkamera',
            'Navigacion': 'Navigation',
            'Sedilje Lëkure': 'Ledersitze',
            'Sensorë Parkimi': 'Parksensoren',
            '4x4': '4x4',
            'Kamera 360': '360-Grad-Kamera',
            'Android Auto': 'Android Auto',
            'Autopilot': 'Autopilot',
            'Kamerat': 'Kameras',
            'Karikues': 'Ladegerät'
        }
    };
    
    // Translate each feature
    return features.map(feature => {
        return featureTranslations[language] && featureTranslations[language][feature] 
            ? featureTranslations[language][feature] 
            : feature;
    }).join(', ');
}